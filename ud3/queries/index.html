
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../operacionescrud/">
      
      
        <link rel="next" href="../relations/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.11">
    
    
      
        <title>3.6.- Formas de realizar consultas en Hibernate - Acceso a Datos</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="Teal">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#formas-de-realizar-consultas-en-hibernate" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Acceso a Datos" class="md-header__button md-logo" aria-label="Acceso a Datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Acceso a Datos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3.6.- Formas de realizar consultas en Hibernate
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="Teal"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="Teal"  aria-label="Cambiar a modo d√≠a"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Cambiar a modo d√≠a" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B√∫squeda" placeholder="B√∫squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b√∫squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegaci√≥n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Acceso a Datos" class="md-nav__button md-logo" aria-label="Acceso a Datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Acceso a Datos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Inicio
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          1.- Acceso a datos mediante ficheros
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          1.- Acceso a datos mediante ficheros
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/filevsfiles/" class="md-nav__link">
        1.1.- Gesti√≥n de ficheros con Java
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          1.2.- Lectura y escritura de ficheros en Java
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          1.2.- Lectura y escritura de ficheros en Java
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/io/" class="md-nav__link">
        1.2.1.- Introducci√≥n
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
          1.2.2.- Acceso secuencial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_2">
          <span class="md-nav__icon md-icon"></span>
          1.2.2.- Acceso secuencial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/binaryfiles/" class="md-nav__link">
        Operaciones con ficheros binarios en Java
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/characterfiles/" class="md-nav__link">
        Operaciones con ficheros de caracteres en Java
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
          1.2.3.- Acceso aleatorio
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_3">
          <span class="md-nav__icon md-icon"></span>
          1.2.3.- Acceso aleatorio
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/randomaccessfile/" class="md-nav__link">
        Operaciones con ficheros de acceso aleatorio en Java
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/fileswalk/" class="md-nav__link">
        1.3.- Recorrido de directorios con java.nio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/serialization/" class="md-nav__link">
        1.4.- Lectura y escritura de objectos en Java
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/propertiesfile/" class="md-nav__link">
        1.5.- Ficheros de propiedades en Java
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/jsonfiles/" class="md-nav__link">
        1.6.- Ficheros JSON en Java
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/createjar/" class="md-nav__link">
        1.7.- Crear un .jar
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud1/trywithresources/" class="md-nav__link">
        1.8.- try-with-resources
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          2.- Acceso a bases de datos relacionales con JDBC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          2.- Acceso a bases de datos relacionales con JDBC
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/persistencia/" class="md-nav__link">
        2.1.- Persistencia de la informaci√≥n
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/mapeo/" class="md-nav__link">
        2.2.- Introducci√≥n a JDBC y conectores
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/conectores/" class="md-nav__link">
        2.3.- Fundamentos de JDBC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/ddl/" class="md-nav__link">
        2.4.- Definici√≥n de estructuras de BD y ejecuci√≥n de sentencias DDL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/dml/" class="md-nav__link">
        2.5.- Modificaci√≥n de datos con JDBC (DML)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/dql/" class="md-nav__link">
        2.6.- Consultas y manipulaci√≥n de resultados con JDBC (DQL)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/procedures/" class="md-nav__link">
        2.7.- Procedimientos almacenados y CallableStatement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/transactions/" class="md-nav__link">
        2.8.- Gesti√≥n de transacciones en JDBC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/26rendimiento/" class="md-nav__link">
        2.9.- Mejora del rendimiento y buenas pr√°cticas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud2/27projectstructure/" class="md-nav__link">
        2.10.- Desarrollo de aplicaciones completas con JDBC
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          3.- ORM con Hibernate y JPA
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          3.- ORM con Hibernate y JPA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../31mapeo/" class="md-nav__link">
        3.1.- Fundamentos del ORM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jakartajpa/" class="md-nav__link">
        3.2.- Jakarta - JPA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        3.3.- Configuraci√≥n e instalaci√≥n de Hibernate. Mapeo de entidades
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../33hibernate/" class="md-nav__link">
        3.4.- Hibernate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../operacionescrud/" class="md-nav__link">
        3.5.- Operaciones CRUD con objetos en Hibernate
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          3.6.- Formas de realizar consultas en Hibernate
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        3.6.- Formas de realizar consultas en Hibernate
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objetivo" class="md-nav__link">
    üéØ Objetivo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-jpql-hql-hibernate-query-language" class="md-nav__link">
    1Ô∏è‚É£ JPQL / HQL (Hibernate Query Language)
  </a>
  
    <nav class="md-nav" aria-label="1Ô∏è‚É£ JPQL / HQL (Hibernate Query Language)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-es" class="md-nav__link">
    üìò Qu√© es
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo" class="md-nav__link">
    üß† Ejemplo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tipo-de-dato-devuelto" class="md-nav__link">
    üß© Tipo de dato devuelto
  </a>
  
    <nav class="md-nav" aria-label="üß© Tipo de dato devuelto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entidad-completa" class="md-nav__link">
    Entidad completa
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#varios-campos-object-por-defecto" class="md-nav__link">
    Varios campos --&gt; Object[] por defecto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dto-directo-preferido" class="md-nav__link">
    DTO directo --&gt; preferido ‚úÖ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuple" class="md-nav__link">
    Tuple
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ventajas-hqljpql" class="md-nav__link">
    ‚úÖ Ventajas HQL/JPQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-criteria-api-jpa" class="md-nav__link">
    2Ô∏è‚É£ Criteria API (JPA)
  </a>
  
    <nav class="md-nav" aria-label="2Ô∏è‚É£ Criteria API (JPA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-es_1" class="md-nav__link">
    üìò Qu√© es
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pasos" class="md-nav__link">
    üö∂ Pasos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplos" class="md-nav__link">
    üß† Ejemplos
  </a>
  
    <nav class="md-nav" aria-label="üß† Ejemplos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#join" class="md-nav__link">
    JOIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proyeccion-a-dto" class="md-nav__link">
    Proyecci√≥n a DTO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#between-y-like" class="md-nav__link">
    BETWEEN y LIKE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count" class="md-nav__link">
    COUNT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resultado-como-tuple" class="md-nav__link">
    Resultado como TUPLE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-by-having" class="md-nav__link">
    Group By, Having
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tipo-de-dato-devuelto_1" class="md-nav__link">
    üß© Tipo de dato devuelto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ventajas" class="md-nav__link">
    ‚úÖ Ventajas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tabla-resumen" class="md-nav__link">
    ‚û°Ô∏è Tabla Resumen
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-sql-nativo-createnativequery" class="md-nav__link">
    3Ô∏è‚É£ SQL Nativo (createNativeQuery)
  </a>
  
    <nav class="md-nav" aria-label="3Ô∏è‚É£ SQL Nativo (createNativeQuery)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-es_2" class="md-nav__link">
    üìò Qu√© es
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo_1" class="md-nav__link">
    üß† Ejemplo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tipo-de-dato-devuelto_2" class="md-nav__link">
    üß© Tipo de dato devuelto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ventajas_1" class="md-nav__link">
    ‚úÖ Ventajas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#desventajas" class="md-nav__link">
    ‚ö†Ô∏è Desventajas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-namedquery" class="md-nav__link">
    4Ô∏è‚É£ @NamedQuery
  </a>
  
    <nav class="md-nav" aria-label="4Ô∏è‚É£ @NamedQuery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-es_3" class="md-nav__link">
    üìò Qu√© es
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo_2" class="md-nav__link">
    üß† Ejemplo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tipo-de-dato-devuelto_3" class="md-nav__link">
    üß© Tipo de dato devuelto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ventajas_2" class="md-nav__link">
    ‚úÖ Ventajas
  </a>
  
    <nav class="md-nav" aria-label="‚úÖ Ventajas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejecutando-la-consulta" class="md-nav__link">
    üéê EJECUTANDO la consulta
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparativa-general" class="md-nav__link">
    üßæ Comparativa general
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    üìö Conclusi√≥n
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../relations/" class="md-nav__link">
        3.7.- Relaciones avanzadas en Hibernate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../34dao/" class="md-nav__link">
        3.8.- Patr√≥n DAO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../35service/" class="md-nav__link">
        3.9.- Service Layer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          4.- Bases de datos documentales con MongoDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          4.- Bases de datos documentales con MongoDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../udmongodb/mongodb1/" class="md-nav__link">
        4.1.- Introducci√≥n
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          5.- Spring Framework
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          5.- Spring Framework
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud4/41introduccionspring/" class="md-nav__link">
        5.1.- Introducci√≥n a Spring Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud4/42repository/" class="md-nav__link">
        5.2.- Spring Data JPA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud4/43rest/" class="md-nav__link">
        5.3.- API REST - Spring Web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud4/44queryresponse/" class="md-nav__link">
        5.4.- @Query y Response
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          6.- Java Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          6.- Java Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ud5/51modulo/" class="md-nav__link">
        6.1.- M√≥dulos en Java
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objetivo" class="md-nav__link">
    üéØ Objetivo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-jpql-hql-hibernate-query-language" class="md-nav__link">
    1Ô∏è‚É£ JPQL / HQL (Hibernate Query Language)
  </a>
  
    <nav class="md-nav" aria-label="1Ô∏è‚É£ JPQL / HQL (Hibernate Query Language)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-es" class="md-nav__link">
    üìò Qu√© es
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo" class="md-nav__link">
    üß† Ejemplo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tipo-de-dato-devuelto" class="md-nav__link">
    üß© Tipo de dato devuelto
  </a>
  
    <nav class="md-nav" aria-label="üß© Tipo de dato devuelto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entidad-completa" class="md-nav__link">
    Entidad completa
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#varios-campos-object-por-defecto" class="md-nav__link">
    Varios campos --&gt; Object[] por defecto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dto-directo-preferido" class="md-nav__link">
    DTO directo --&gt; preferido ‚úÖ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuple" class="md-nav__link">
    Tuple
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ventajas-hqljpql" class="md-nav__link">
    ‚úÖ Ventajas HQL/JPQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-criteria-api-jpa" class="md-nav__link">
    2Ô∏è‚É£ Criteria API (JPA)
  </a>
  
    <nav class="md-nav" aria-label="2Ô∏è‚É£ Criteria API (JPA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-es_1" class="md-nav__link">
    üìò Qu√© es
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pasos" class="md-nav__link">
    üö∂ Pasos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplos" class="md-nav__link">
    üß† Ejemplos
  </a>
  
    <nav class="md-nav" aria-label="üß† Ejemplos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#join" class="md-nav__link">
    JOIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proyeccion-a-dto" class="md-nav__link">
    Proyecci√≥n a DTO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#between-y-like" class="md-nav__link">
    BETWEEN y LIKE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count" class="md-nav__link">
    COUNT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resultado-como-tuple" class="md-nav__link">
    Resultado como TUPLE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-by-having" class="md-nav__link">
    Group By, Having
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tipo-de-dato-devuelto_1" class="md-nav__link">
    üß© Tipo de dato devuelto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ventajas" class="md-nav__link">
    ‚úÖ Ventajas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tabla-resumen" class="md-nav__link">
    ‚û°Ô∏è Tabla Resumen
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-sql-nativo-createnativequery" class="md-nav__link">
    3Ô∏è‚É£ SQL Nativo (createNativeQuery)
  </a>
  
    <nav class="md-nav" aria-label="3Ô∏è‚É£ SQL Nativo (createNativeQuery)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-es_2" class="md-nav__link">
    üìò Qu√© es
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo_1" class="md-nav__link">
    üß† Ejemplo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tipo-de-dato-devuelto_2" class="md-nav__link">
    üß© Tipo de dato devuelto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ventajas_1" class="md-nav__link">
    ‚úÖ Ventajas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#desventajas" class="md-nav__link">
    ‚ö†Ô∏è Desventajas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-namedquery" class="md-nav__link">
    4Ô∏è‚É£ @NamedQuery
  </a>
  
    <nav class="md-nav" aria-label="4Ô∏è‚É£ @NamedQuery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-es_3" class="md-nav__link">
    üìò Qu√© es
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo_2" class="md-nav__link">
    üß† Ejemplo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tipo-de-dato-devuelto_3" class="md-nav__link">
    üß© Tipo de dato devuelto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ventajas_2" class="md-nav__link">
    ‚úÖ Ventajas
  </a>
  
    <nav class="md-nav" aria-label="‚úÖ Ventajas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejecutando-la-consulta" class="md-nav__link">
    üéê EJECUTANDO la consulta
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparativa-general" class="md-nav__link">
    üßæ Comparativa general
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    üìö Conclusi√≥n
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="formas-de-realizar-consultas-en-hibernate">üß© Formas de realizar consultas en Hibernate</h1>
<h2 id="objetivo">üéØ Objetivo</h2>
<p>Aprender las principales formas de crear <strong>consultas (querys)</strong> en Hibernate 6 / Jakarta JPA:<br />
- JPQL / HQL<br />
- Criteria API<br />
- SQL Nativo<br />
- @NamedQuery  </p>
<p>Adem√°s, se explica <strong>qu√© tipo de datos devuelve cada una</strong> (entidad, DTO, <code>Object[]</code>, <code>Tuple</code>, etc.).</p>
<hr />
<h2 id="1-jpql-hql-hibernate-query-language">1Ô∏è‚É£ JPQL / HQL (Hibernate Query Language)</h2>
<h3 id="que-es">üìò Qu√© es</h3>
<p>JPQL (Java Persistence Query Language) se inspir√≥ en las primeras versiones de HQL y es un subconjunto del HQL moderno.
Lenguaje orientado a <strong>entidades</strong> y <strong>atributos</strong>, no a tablas SQL.  </p>
<p>Hibernate usa un poderoso lenguaje de consulta (HQL) que es similar en apariencia a SQL. Sin embargo, en comparaci√≥n con SQL, <strong>HQL est√° completamente orientado a objetos y comprende nociones como herencia, polimorfismo y asociaci√≥n</strong>.</p>
<h3 id="ejemplo">üß† Ejemplo</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">String</span><span class="w"> </span><span class="n">jpql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT s FROM Space s WHERE s.active = true AND s.capacity &gt;= :min&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">jpql</span><span class="p">,</span><span class="w"> </span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">&quot;min&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>
</code></pre></div>
<div class="highlight"><span class="filename">named parameters</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1">//JPQL</span>
<span class="linenos" data-linenos="2 "></span><span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="s">&quot;SELECT u FROM Usuario u WHERE u.email LIKE :mail ORDER BY u.nombre&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="n">Usuario</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="n">q</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">&quot;mail&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%@example.com%&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="6 "></span><span class="n">q</span><span class="p">.</span><span class="na">setMaxResults</span><span class="p">(</span><span class="mi">50</span><span class="p">).</span><span class="na">setFirstResult</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// paginaci√≥n</span>
<span class="linenos" data-linenos="7 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">&gt;</span><span class="w"> </span><span class="n">usuarios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>
</code></pre></div>
<div class="highlight"><span class="filename">ordinal parameters</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="w">    </span><span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Tramite</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span>
<span class="linenos" data-linenos="2 "></span><span class="w">                            </span><span class="s">&quot;from Tramite where tipo = ?1&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="3 "></span><span class="w">                            </span><span class="n">Tramite</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="4 "></span><span class="w">                    </span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Cr√©dito&quot;</span><span class="p">);</span>
</code></pre></div>
<div class="admonition warning warning">
<p class="admonition-title">Warning</p>
<p>No es una buena idea mezclar <em>named parameters</em> y <em>ordinales</em> en una sola consulta.</p>
</div>
<p><strong>JOIN y proyecciones (DTO):</strong>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">UsuarioPedidoDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dtos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="s">&quot;SELECT new com.acme.dto.UsuarioPedidoDTO(u.id, u.nombre, COUNT(p)) &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="s">&quot;FROM Usuario u LEFT JOIN u.pedidos p &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="s">&quot;GROUP BY u.id, u.nombre &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="s">&quot;ORDER BY COUNT(p) DESC&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="n">UsuarioPedidoDTO</span><span class="p">.</span><span class="na">class</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">).</span><span class="na">getResultList</span><span class="p">();</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">//tambi√©n se puede hacer el join impl√≠cito  (INNER JOIN) navegando con &quot;.&quot;: r.event.name, navegamos </span>
<span class="linenos" data-linenos="10 "></span><span class="c1">//desde Registration, por Event hasta el atributo de name en la entidad Event.</span>
<span class="linenos" data-linenos="11 "></span><span class="n">String</span><span class="w"> </span><span class="n">jpql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT r.event.name, r.event.organizer.name, r.registrationDate, r.attendee.name &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos" data-linenos="12 "></span><span class="w">                    </span><span class="s">&quot;FROM Registration r &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos" data-linenos="13 "></span><span class="w">                    </span><span class="s">&quot;WHERE r.event.organizer.email = ?1 &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos" data-linenos="14 "></span><span class="w">                    </span><span class="s">&quot;AND r.status = &#39;confirmed&#39; &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos" data-linenos="15 "></span><span class="w">                    </span><span class="s">&quot;ORDER BY r.event.name&quot;</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="tipo-de-dato-devuelto">üß© Tipo de dato devuelto</h3>
<h4 id="entidad-completa">Entidad completa</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="s">&quot;select c from Customer c where c.active = true&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Customer</span><span class="p">.</span><span class="na">class</span>
<span class="linenos" data-linenos="3 "></span><span class="p">).</span><span class="na">getResultList</span><span class="p">();</span>
</code></pre></div>
<h3 id="varios-campos-object-por-defecto">Varios campos --&gt; Object[] por defecto</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="s">&quot;select c.name, c.email from Customer c where c.active = true&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">.</span><span class="na">class</span>
<span class="linenos" data-linenos="3 "></span><span class="p">).</span><span class="na">getResultList</span><span class="p">();</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">rows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="6 "></span><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">row</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<span class="linenos" data-linenos="7 "></span><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="dto-directo-preferido">DTO directo --&gt; preferido ‚úÖ</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">String</span><span class="w"> </span><span class="n">hql</span><span class="w"> </span><span class="o">=</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="s">&quot;select new com.acme.CustomerDto(c.id, c.name, c.email) &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="s">&quot;from Customer c where c.active = true&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">CustomerDto</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">hql</span><span class="p">,</span><span class="w"> </span><span class="n">CustomerDto</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">CustomerDto</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>
</code></pre></div>
<h3 id="tuple">Tuple</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="s">&quot;select c.name as name, c.email as email from Customer c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Tuple</span><span class="p">.</span><span class="na">class</span>
<span class="linenos" data-linenos="3 "></span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span><span class="w"> </span>
<span class="linenos" data-linenos="5 "></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Tuple</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">rows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="6 "></span><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Tipo de consulta</th>
<th>Devuelve</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SELECT s FROM Space s</code></td>
<td><code>List&lt;Space&gt;</code> (entidades gestionadas)</td>
</tr>
<tr>
<td><code>SELECT s.name FROM Space s</code></td>
<td><code>List&lt;String&gt;</code></td>
</tr>
<tr>
<td><code>SELECT s.id, s.name FROM Space s</code></td>
<td><code>List&lt;Object[]&gt;</code> o <code>Tuple</code></td>
</tr>
<tr>
<td><code>SELECT new es.coworking.SpaceDTO(s.id, s.name)</code></td>
<td><code>List&lt;SpaceDTO&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="ventajas-hqljpql">‚úÖ Ventajas HQL/JPQL</h3>
<ul>
<li>Legible y portable entre SGBD.  </li>
<li>Permite joins, subconsultas, funciones agregadas.  </li>
<li>Compatible con proyecciones (DTOs).</li>
</ul>
<hr />
<h2 id="2-criteria-api-jpa">2Ô∏è‚É£ Criteria API (JPA)</h2>
<h3 id="que-es_1">üìò Qu√© es</h3>
<p>API <strong>program√°tica y tipada</strong> para construir queries tipadas y din√°micas con objetos Java.<br />
Ideal cuando los filtros dependen de condiciones del usuario o se generan en tiempo de ejecuci√≥n.</p>
<h3 id="pasos">üö∂ Pasos</h3>
<ol>
<li>Consigue el CriteriaBuilder de la session.</li>
</ol>
<p><code>CriteriaBuilder</code> es la f√°brica de construcciones (builder) stateless de la API de Criteria de JPA/Hibernate.
Sirve para <strong>crear de forma tipada</strong> todos los ‚Äúladrillos‚Äù de una consulta. Cada llamada <strong>devuelve objetos nuevos</strong>. No guarda configuraci√≥n ni estado global.</p>
<table>
<thead>
<tr>
<th>Categor√≠a</th>
<th>M√©todo</th>
<th>Uso / Ejemplo</th>
<th>SQL equivalente</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Select / Agregaci√≥n</strong></td>
<td><code>cb.count(expr)</code></td>
<td>Cuenta filas</td>
<td><code>COUNT(*)</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.countDistinct(expr)</code></td>
<td>Cuenta sin duplicados</td>
<td><code>COUNT(DISTINCT x)</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.sum(expr)</code> / <code>cb.avg(expr)</code></td>
<td>Suma / media</td>
<td><code>SUM(x)</code> / <code>AVG(x)</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.max(expr)</code> / <code>cb.min(expr)</code></td>
<td>M√°ximo / m√≠nimo</td>
<td><code>MAX(x)</code> / <code>MIN(x)</code></td>
</tr>
<tr>
<td><strong>Comparaci√≥n</strong></td>
<td><code>cb.equal(x, y)</code> / <code>cb.notEqual(x, y)</code></td>
<td>Igual / distinto</td>
<td><code>=</code>, <code>&lt;&gt;</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.greaterThan(x,y)</code>, <code>cb.gt</code> / <code>cb.ge</code>, <code>cb.greaterThanOrEqualTo</code></td>
<td>Mayor / mayor o igual</td>
<td><code>&gt;</code>, <code>&gt;=</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.lessThan(x, y)</code>, <code>cb/lt</code> / <code>cb.le</code>, <code>cb.lessThanOrEqualTo</code></td>
<td>Menor / menor o igual</td>
<td><code>&lt;</code>, <code>&lt;=</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.between(x, a, b)</code></td>
<td>Dentro de un rango</td>
<td><code>BETWEEN a AND b</code></td>
</tr>
<tr>
<td><strong>Booleanos</strong></td>
<td><code>cb.isTrue(expr)</code></td>
<td>Comprueba <code>true</code></td>
<td><code>WHERE col = true</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.isFalse(expr)</code></td>
<td>Comprueba <code>false</code></td>
<td><code>WHERE col = false</code></td>
</tr>
<tr>
<td><strong>Nulos y colecciones</strong></td>
<td><code>cb.isNull(expr)</code> / <code>cb.isNotNull(expr)</code></td>
<td>Valor nulo / no nulo</td>
<td><code>IS NULL</code> / <code>IS NOT NULL</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.isEmpty(collection)</code> / <code>cb.isNotEmpty(collection)</code></td>
<td>Colecci√≥n vac√≠a / no vac√≠a</td>
<td><code>NOT EXISTS(...)</code> / <code>EXISTS(...)</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.isMember(elem, collection)</code> / <code>cb.isNotMember(elem, collection)</code></td>
<td>Pertenencia a colecci√≥n</td>
<td><code>elem IN (subquery)</code></td>
</tr>
<tr>
<td><strong>Texto / cadenas</strong></td>
<td><code>cb.like(expr, pattern)</code> / <code>cb.notLike(expr, pattern)</code></td>
<td>Coincidencia parcial</td>
<td><code>LIKE</code> / <code>NOT LIKE</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.lower(expr)</code> / <code>cb.upper(expr)</code></td>
<td>Min√∫sculas / may√∫sculas</td>
<td><code>LOWER()</code> / <code>UPPER()</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.concat(a, b)</code></td>
<td>Concatenaci√≥n de cadenas</td>
<td><code>CONCAT(a, b)</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.length(expr)</code></td>
<td>Longitud de cadena</td>
<td><code>LENGTH(expr)</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.locate(str, sub)</code></td>
<td>Posici√≥n de substring</td>
<td><code>LOCATE(sub, str)</code></td>
</tr>
<tr>
<td><strong>Fechas / tiempos</strong></td>
<td><code>cb.currentDate()</code> / <code>cb.currentTimestamp()</code></td>
<td>Fecha/hora actual</td>
<td><code>CURRENT_DATE</code> / <code>CURRENT_TIMESTAMP</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.greaterThan(date1, date2)</code></td>
<td>Comparar fechas</td>
<td><code>&gt;</code></td>
</tr>
<tr>
<td><strong>L√≥gicos</strong></td>
<td><code>cb.and(p1, p2, ‚Ä¶)</code></td>
<td>Conjunci√≥n</td>
<td><code>AND</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.or(p1, p2, ‚Ä¶)</code></td>
<td>Disyunci√≥n</td>
<td><code>OR</code></td>
</tr>
<tr>
<td></td>
<td><code>cb.not(p)</code></td>
<td>Negaci√≥n</td>
<td><code>NOT</code></td>
</tr>
<tr>
<td><strong>Subconsultas</strong></td>
<td><code>cb.exists(subquery)</code> / <code>cb.not(cb.exists(...))</code></td>
<td>Comprobar existencia</td>
<td><code>EXISTS(subquery)</code></td>
</tr>
<tr>
<td><strong>Ordenaci√≥n</strong></td>
<td><code>cb.asc(expr)</code> / <code>cb.desc(expr)</code></td>
<td>Orden asc / desc</td>
<td><code>ORDER BY col ASC/DESC</code></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">CriteriaBuilder</span><span class="w"> </span><span class="n">cb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">getCriteriaBuilder</span><span class="p">();</span>
</code></pre></div>
<ol>
<li>Crea la consulta (elige el tipo de resultado):</li>
</ol>
<p>CriteriaQuery es la representaci√≥n en Java de una consulta JPQL.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Usuario</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"> </span><span class="c1">// tipada</span>
<span class="linenos" data-linenos="2 "></span><span class="c1">// o: CriteriaQuery&lt;Tuple&gt; cq = cb.createTupleQuery();      // tuplas</span>
<span class="linenos" data-linenos="3 "></span><span class="c1">// o: CriteriaQuery&lt;Object[]&gt; cq = cb.createQuery(Object[].class); // arrays</span>
<span class="linenos" data-linenos="4 "></span><span class="c1">// o: CriteriaQuery&lt;TopSpaceRevenueDto&gt; d = cb.createQuery(TopSpaceRevenueDto.class); //Dto</span>
</code></pre></div>
<ol>
<li>Define la ra√≠z (Root)</li>
</ol>
<p>La ra√≠z siempre es una entidad. Es el FROM de la query SQL.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">&gt;</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cq</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Usuario</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</code></pre></div>
<ol>
<li>Define las uniones JOIN, si las necesitas</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Booking</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Booking</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span><span class="n">Join</span><span class="o">&lt;</span><span class="n">Booking</span><span class="p">,</span><span class="w"> </span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="s">&quot;space&quot;</span><span class="p">);</span><span class="c1">//nombre del objeto en la clase Booking</span>
</code></pre></div>
<ol>
<li>Selecciona lo que quieres devolver</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">cq</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">u</span><span class="p">);</span><span class="w"> </span><span class="c1">// opcional si solo hay un root, devuelve todo el objeto, como poner * en una select</span>
<span class="linenos" data-linenos="2 "></span><span class="n">cq</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;email&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">//devuelve un campo</span>
<span class="linenos" data-linenos="3 "></span><span class="n">cq</span><span class="p">.</span><span class="na">multiselect</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// -&gt; devuelve varios campos en forma de Tuple</span>
<span class="linenos" data-linenos="4 "></span><span class="n">cq</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">construct</span><span class="p">(</span><span class="n">UserDTO</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">)));</span><span class="w"> </span><span class="c1">//Como DTO/wrapper (lo m√°s limpio)</span>
</code></pre></div>
<ol>
<li>A√±ade filtros (predicados)</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="w"> </span><span class="n">cq</span><span class="p">.</span><span class="na">multiselect</span><span class="p">(</span>
<span class="linenos" data-linenos="2 "></span><span class="w">            </span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">),</span>
<span class="linenos" data-linenos="3 "></span><span class="w">            </span><span class="n">cb</span><span class="p">.</span><span class="na">count</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="p">)</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">and</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">isNull</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;fechaFin&quot;</span><span class="p">)),</span>
<span class="linenos" data-linenos="6 "></span><span class="w">            </span><span class="n">cb</span><span class="p">.</span><span class="na">ge</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;capacidad&quot;</span><span class="p">),</span><span class="mi">10</span><span class="p">)))</span><span class="w">     </span><span class="c1">//decimos que la fechaFin no sea nula y que capacidad sea mayor que 10</span>
</code></pre></div>
<ol>
<li>Orden</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">cq</span><span class="p">.</span><span class="na">orderBy</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">asc</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">)));</span>
<span class="linenos" data-linenos="2 "></span><span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">cq</span><span class="p">);</span>
</code></pre></div>
<ol>
<li>Ejecuta</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Usuario</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resultados</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">cq</span><span class="p">).</span><span class="na">getResultList</span><span class="p">();</span>
</code></pre></div>
<h3 id="ejemplos">üß† Ejemplos</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">CriteriaBuilder</span><span class="w"> </span><span class="n">cb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">getCriteriaBuilder</span><span class="p">();</span>
<span class="linenos" data-linenos=" 2 "></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cq</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">cq</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">and</span><span class="p">(</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">      </span><span class="n">cb</span><span class="p">.</span><span class="na">isTrue</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;active&quot;</span><span class="p">)),</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span><span class="n">cb</span><span class="p">.</span><span class="na">ge</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;capacity&quot;</span><span class="p">),</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="p">));</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">cq</span><span class="p">).</span><span class="na">getResultList</span><span class="p">();</span>
</code></pre></div>
<h4 id="join">JOIN</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">CriteriaBuilder</span><span class="w"> </span><span class="n">cb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">getCriteriaBuilder</span><span class="p">();</span>
<span class="linenos" data-linenos="2 "></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cq</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="n">Join</span><span class="o">&lt;</span><span class="n">Space</span><span class="p">,</span><span class="w"> </span><span class="n">Venue</span><span class="o">&gt;</span><span class="w"> </span><span class="n">jVenue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="s">&quot;venue&quot;</span><span class="p">);</span><span class="c1">//INNER JOIN</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="n">cq</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="linenos" data-linenos="6 "></span><span class="w">            </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">equal</span><span class="p">(</span><span class="n">jVenue</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;city&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Zaragoza&quot;</span><span class="p">));</span>
</code></pre></div>
<h4 id="proyeccion-a-dto">Proyecci√≥n a DTO</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">SpaceCardDto</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cq3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">SpaceCardDto</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span><span class="w">            </span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cq3</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="w">            </span><span class="n">cq3</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">construct</span><span class="p">(</span>
<span class="linenos" data-linenos="4 "></span><span class="w">                    </span><span class="n">SpaceCardDto</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="5 "></span><span class="w">                    </span><span class="n">r3</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;code&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">r3</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">r3</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;hourlyPrice&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="6 "></span><span class="w">            </span><span class="p">));</span>
<span class="linenos" data-linenos="7 "></span>
<span class="linenos" data-linenos="8 "></span><span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SpaceCardDto</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rows2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">cq3</span><span class="p">).</span><span class="na">getResultList</span><span class="p">();</span>
<span class="linenos" data-linenos="9 "></span><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">rows2</span><span class="p">);</span>
</code></pre></div>
<h4 id="between-y-like">BETWEEN y LIKE</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1">//BETWEEN, espacios en los que el precio por hora est√° entre 10 y 30</span>
<span class="linenos" data-linenos="2 "></span><span class="n">cq</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="w">        </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">between</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;hourlyPrice&quot;</span><span class="p">),</span>
<span class="linenos" data-linenos="4 "></span><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;10&quot;</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;30&quot;</span><span class="p">)));</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="c1">//LIKE</span>
<span class="linenos" data-linenos="7 "></span><span class="n">String</span><span class="w"> </span><span class="n">keyword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;meeting&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span><span class="w">  </span><span class="n">cq</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="linenos" data-linenos="9 "></span><span class="w">          </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">like</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">lower</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;%&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">keyword</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;%&quot;</span><span class="p">));</span>
</code></pre></div>
<h4 id="count">COUNT</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cqCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cqCount</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="n">cqCount</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">count</span><span class="p">(</span><span class="n">rCount</span><span class="p">))</span>
<span class="linenos" data-linenos="4 "></span><span class="w">        </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">isTrue</span><span class="p">(</span><span class="n">rCount</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;active&quot;</span><span class="p">)));</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="n">Long</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">cqCount</span><span class="p">).</span><span class="na">getSingleResult</span><span class="p">();</span>
</code></pre></div>
<h4 id="resultado-como-tuple">Resultado como TUPLE</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">//resultado como tuple</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cqTuple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createTupleQuery</span><span class="p">();</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cqTuple</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="n">Join</span><span class="o">&lt;</span><span class="n">Space</span><span class="p">,</span><span class="w"> </span><span class="n">Venue</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rT</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="s">&quot;venue&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="n">cqTuple</span><span class="p">.</span><span class="na">multiselect</span><span class="p">(</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">          </span><span class="n">rT</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">).</span><span class="na">alias</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">          </span><span class="n">rT</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="na">alias</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">),</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">          </span><span class="n">vT</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="na">alias</span><span class="p">(</span><span class="s">&quot;venueName&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="10 "></span><span class="w">  </span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rows3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">cqTuple</span><span class="p">).</span><span class="na">getResultList</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Tuple</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">rows3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span><span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span><span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">venueName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;venueName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  &quot;</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;   &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">venueName</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span><span class="w">  </span><span class="p">}</span>
</code></pre></div>
<h4 id="group-by-having">Group By, Having</h4>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">cq2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Object</span><span class="o">[]</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cq2</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="n">Join</span><span class="o">&lt;</span><span class="n">Space</span><span class="p">,</span><span class="w"> </span><span class="n">Venue</span><span class="o">&gt;</span><span class="w"> </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="s">&quot;venue&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="n">Expression</span><span class="o">&lt;</span><span class="n">BigDecimal</span><span class="o">&gt;</span><span class="w"> </span><span class="n">avgPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">avg</span><span class="p">(</span><span class="n">s2</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)).</span><span class="na">as</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="n">cq2</span><span class="p">.</span><span class="na">multiselect</span><span class="p">(</span><span class="n">v2</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;city&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">avgPrice</span><span class="p">)</span>
<span class="linenos" data-linenos="8 "></span><span class="w">   </span><span class="p">.</span><span class="na">groupBy</span><span class="p">(</span><span class="n">v2</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;city&quot;</span><span class="p">))</span>
<span class="linenos" data-linenos="9 "></span><span class="w">   </span><span class="p">.</span><span class="na">having</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">greaterThan</span><span class="p">(</span><span class="n">avgPrice</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;20&quot;</span><span class="p">)));</span>
</code></pre></div>
<h3 id="tipo-de-dato-devuelto_1">üß© Tipo de dato devuelto</h3>
<ul>
<li>Si defines <code>CriteriaQuery&lt;Space&gt;</code> ‚Üí <code>List&lt;Space&gt;</code>  </li>
<li>Si seleccionas varios atributos (<code>cb.tuple(...)</code>) ‚Üí <code>List&lt;Tuple&gt;</code>  </li>
<li>Si seleccionas columnas espec√≠ficas ‚Üí <code>List&lt;Object[]&gt;</code>  </li>
<li>Tambi√©n puede proyectarse a un DTO usando <code>cb.construct(...)</code>.</li>
</ul>
<h3 id="ventajas">‚úÖ Ventajas</h3>
<ul>
<li>Type-safe (detecta errores en compilaci√≥n).  </li>
<li>Ideal para consultas din√°micas.  </li>
<li>100% est√°ndar JPA.</li>
</ul>
<h2 id="tabla-resumen">‚û°Ô∏è Tabla Resumen</h2>
<ul>
<li>CriteriaBuilder (<code>cb</code>) ‚Üí f√°brica de piezas: <code>Predicate</code>, <code>Expression</code>, <code>Order</code>, etc.   </li>
<li>CriteriaQuery (<code>cq</code>) ‚Üí plano de la consulta: <code>select</code>, <code>from</code>, <code>where</code>, <code>groupBy</code>, <code>having</code>, <code>orderBy</code>, <code>distinct</code>.   </li>
<li>Desde el <code>from</code> (un Root/Join) sacas rutas (Path) y haces joins.      </li>
</ul>
<table>
<thead>
<tr>
<th>Clase</th>
<th>Qu√© es</th>
<th>Qui√©n la crea</th>
<th>D√≥nde se usa</th>
<th>Ejemplo corto</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CriteriaBuilder</code></td>
<td>F√°brica y helpers</td>
<td><code>em.getCriteriaBuilder()</code></td>
<td>En todas partes para construir cosas</td>
<td><code>cb.equal(‚Ä¶), cb.and(‚Ä¶), cb.sum(‚Ä¶)</code></td>
</tr>
<tr>
<td><code>CriteriaQuery&lt;T&gt;</code></td>
<td>Plano tipado de la query <code>SELECT</code></td>
<td><code>cb.createQuery(T.class)</code></td>
<td><code>select</code>, <code>where</code>, <code>groupBy</code>, ‚Ä¶</td>
<td><code>cq.select(u).where(pred)</code></td>
</tr>
<tr>
<td><code>Root&lt;T&gt;</code></td>
<td>Ra√≠z de <code>FROM</code> (tabla principal)</td>
<td><code>cq.from(T.class)</code></td>
<td>Para acceder a campos y hacer joins</td>
<td><code>Root&lt;User&gt; u = cq.from(User.class)</code></td>
</tr>
<tr>
<td><code>Join&lt;X,Y&gt;</code></td>
<td>Join tipado a una relaci√≥n</td>
<td><code>root.join("roles")</code></td>
<td>Igual que tabla unida</td>
<td><code>Join&lt;User,Role&gt; r = u.join("roles")</code></td>
</tr>
<tr>
<td><code>Path&lt;X&gt;</code></td>
<td>Ruta a un atributo (columna)</td>
<td><code>root.get("email")</code></td>
<td>Alimenta <code>Expression</code>, <code>Predicate</code></td>
<td><code>Path&lt;String&gt; p = u.get("name")</code></td>
</tr>
<tr>
<td><code>Expression&lt;X&gt;</code></td>
<td>Valor calculado (sum, lower, etc)</td>
<td><code>cb.lower(path)</code>, <code>cb.sum(‚Ä¶)</code></td>
<td><code>select</code>, <code>groupBy</code>, <code>orderBy</code>, <code>having</code></td>
<td><code>Expression&lt;String&gt; e = cb.lower(p)</code></td>
</tr>
<tr>
<td><code>Predicate</code></td>
<td>Condici√≥n booleana</td>
<td><code>cb.equal(‚Ä¶)</code>, <code>cb.and(‚Ä¶)</code></td>
<td><code>where</code>, <code>having</code></td>
<td><code>Predicate p = cb.equal(u.get("active"), true)</code></td>
</tr>
<tr>
<td><code>Order</code></td>
<td>Ordenaci√≥n</td>
<td><code>cb.asc(expr)</code>, <code>cb.desc(expr)</code></td>
<td><code>orderBy</code></td>
<td><code>cq.orderBy(cb.desc(u.get("createdAt")))</code></td>
</tr>
<tr>
<td><code>Subquery&lt;X&gt;</code></td>
<td>Subconsulta</td>
<td><code>cq.subquery(X.class)</code></td>
<td>Como parte de <code>where</code>, <code>select</code></td>
<td><code>Subquery&lt;Long&gt; sq = cq.subquery(Long.class)</code></td>
</tr>
<tr>
<td><code>CompoundSelection&lt;T&gt;</code></td>
<td>Selecci√≥n compuesta (DTO/tuple)</td>
<td><code>cb.construct(Dto.class, ‚Ä¶)</code></td>
<td><code>select</code> / <code>multiselect</code></td>
<td><code>cq.select(cb.construct(Dto.class, u.get("id"), ‚Ä¶))</code></td>
</tr>
<tr>
<td><code>Tuple</code> y <code>TupleQuery</code></td>
<td>Fila heterog√©nea y su query</td>
<td><code>cb.createTupleQuery()</code></td>
<td>Cuando quieres columnas sueltas</td>
<td><code>TupleQuery tq = cb.createTupleQuery()</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3-sql-nativo-createnativequery">3Ô∏è‚É£ SQL Nativo (<code>createNativeQuery</code>)</h2>
<h3 id="que-es_2">üìò Qu√© es</h3>
<p>Permite ejecutar SQL <strong>directamente sobre la base de datos</strong>.<br />
Se usa cuando necesitas funciones espec√≠ficas del motor o rendimiento extremo.</p>
<h3 id="ejemplo_1">üß† Ejemplo</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT * FROM spaces WHERE active = 1 AND capacity &gt;= ?&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createNativeQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="w"> </span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">filas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createNativeQuery</span><span class="p">(</span>
<span class="linenos" data-linenos="7 "></span><span class="w">  </span><span class="s">&quot;SELECT id, nombre FROM usuarios WHERE email LIKE ?&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="8 "></span><span class="w">  </span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%@example.com%&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="9 "></span><span class="w">  </span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>
</code></pre></div>
<h3 id="tipo-de-dato-devuelto_2">üß© Tipo de dato devuelto</h3>
<table>
<thead>
<tr>
<th>Par√°metro usado</th>
<th>Devuelve</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>createNativeQuery(sql)</code></td>
<td><code>List&lt;Object[]&gt;</code></td>
</tr>
<tr>
<td><code>createNativeQuery(sql, Space.class)</code></td>
<td><code>List&lt;Space&gt;</code> (entidades gestionadas)</td>
</tr>
<tr>
<td><code>createNativeQuery(sql, Tuple.class)</code></td>
<td><code>List&lt;Tuple&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="ventajas_1">‚úÖ Ventajas</h3>
<ul>
<li>Acceso total al SQL y funciones nativas.  </li>
<li>Permite mapear a entidades o DTOs.  </li>
<li>√ötil para consultas complejas o migraciones.</li>
</ul>
<h3 id="desventajas">‚ö†Ô∏è Desventajas</h3>
<ul>
<li>No es portable entre bases de datos.  </li>
<li>No aprovecha completamente el contexto de persistencia.</li>
</ul>
<hr />
<h2 id="4-namedquery">4Ô∏è‚É£ @NamedQuery</h2>
<h3 id="que-es_3">üìò Qu√© es</h3>
<p>Consultas <strong>JPQL predefinidas</strong>, declaradas en la propia entidad.<br />
Hibernate las valida al iniciar la aplicaci√≥n.</p>
<h3 id="ejemplo_2">üß† Ejemplo</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nd">@Entity</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nd">@NamedQuery</span><span class="p">(</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Space.findActive&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;FROM Space s WHERE s.active = true&quot;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">)</span>
<span class="linenos" data-linenos=" 6 "></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Space</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="c1">// Uso</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Space</span><span class="o">&gt;</span><span class="w"> </span><span class="n">spaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createNamedQuery</span><span class="p">(</span><span class="s">&quot;Space.findActive&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="10 "></span><span class="w">                       </span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>
</code></pre></div>
<h3 id="tipo-de-dato-devuelto_3">üß© Tipo de dato devuelto</h3>
<ul>
<li>Igual que JPQL: entidad (<code>List&lt;Space&gt;</code>), atributo (<code>List&lt;String&gt;</code>), DTO (<code>List&lt;Object[]&gt;</code> o <code>List&lt;DTO&gt;</code>).</li>
</ul>
<h3 id="ventajas_2">‚úÖ Ventajas</h3>
<ul>
<li>Centraliza consultas reutilizables.  </li>
<li>Validaci√≥n temprana (errores detectados al arrancar).  </li>
<li>Buenas pr√°cticas para queries compartidas.</li>
</ul>
<hr />
<h4 id="ejecutando-la-consulta">üéê <em>EJECUTANDO la consulta</em></h4>
<p>Dentro de la query se puede restringir el n√∫mero de resultados que devuelve con la opci√≥n <code>setMaxResults(int maxResults)</code>.
Ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT * FROM spaces WHERE active = 1 AND capacity &gt;= ?&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">Space</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createNativeQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="w"> </span><span class="n">Space</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="p">.</span><span class="na">setMaxResults</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="p">.</span><span class="na">getSingleResultOrNull</span><span class="p">();</span>
</code></pre></div>
<p>La interfaz <code>TypedQuery</code> se utiliza para controlar la ejecuci√≥n de la consulta. Ofrece tres tipos de resultados:</p>
<ul>
<li><code>getResultList()</code>: devuelve una lista con los resultados (lista vac√≠a si no hay filas). No lanza excepci√≥n por ‚Äúcero resultados‚Äù..</li>
<li><code>getSingleResult()</code>: es solo para casos en los que la consulta siempre <strong>devuelve exactamente un resultado</strong>. Lanza excepci√≥n si no hay ninguno o si hay m√°s de uno.</li>
<li><code>getSingleResultOrNull()</code> ‚Üí devuelve el √∫nico resultado o null si no hay ninguno; sigue lanzando excepci√≥n si hay m√°s de uno.</li>
<li><code>getResultStream()</code>: permite que los resultados se recuperen <strong>de forma incremental</strong>, utilizando un cursor de base de datos.</li>
</ul>
<div class="admonition warning warning">
<p class="admonition-title">Warning</p>
<p>El m√©todo <code>getResultStream()</code> <strong>no suele ser √∫til</strong>. Casi siempre es una mala idea mantener abierto el cursor de una base de datos.</p>
</div>
<hr />
<h2 id="comparativa-general">üßæ Comparativa general</h2>
<table>
<thead>
<tr>
<th>Tipo de Query</th>
<th>Sintaxis</th>
<th>Tipo de retorno</th>
<th>Uso t√≠pico</th>
<th>Ventajas</th>
<th>Desventajas</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>JPQL/HQL</strong></td>
<td>Texto (entidades)</td>
<td><code>List&lt;Entidad&gt;</code>, <code>List&lt;Object[]&gt;</code>, <code>List&lt;Tuple&gt;</code>, <code>List&lt;DTO&gt;</code></td>
<td>Consultas est√°ndar</td>
<td>Legible y portable</td>
<td>No tipo-segura</td>
</tr>
<tr>
<td><strong>Criteria API</strong></td>
<td>Program√°tica (Java)</td>
<td><code>List&lt;Entidad&gt;</code>, <code>List&lt;Tuple&gt;</code>, <code>List&lt;DTO&gt;</code></td>
<td>Filtros din√°micos</td>
<td>Tipo-segura y est√°ndar</td>
<td>Verbosa</td>
</tr>
<tr>
<td><strong>SQL Nativo</strong></td>
<td>SQL directo</td>
<td><code>List&lt;Object[]&gt;</code>, <code>List&lt;Tuple&gt;</code>, <code>List&lt;Entidad&gt;</code></td>
<td>Casos complejos o rendimiento</td>
<td>Potente y flexible</td>
<td>No portable</td>
</tr>
<tr>
<td><strong>@NamedQuery</strong></td>
<td>Declarativa</td>
<td>Igual que JPQL</td>
<td>Consultas reutilizables</td>
<td>Validada al inicio</td>
<td>Menos flexible</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="conclusion">üìö Conclusi√≥n</h2>
<ul>
<li>Usa <strong>JPQL/HQL</strong> para la mayor√≠a de los casos.  </li>
<li>Usa <strong>Criteria API</strong> cuando necesites construir filtros din√°micos.  </li>
<li>Usa <strong>SQL nativo</strong> cuando necesites funciones espec√≠ficas o rendimiento extremo.  </li>
<li>Usa <strong>@NamedQuery</strong> para centralizar y reutilizar consultas comunes.</li>
</ul>


  




                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Volver al principio
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navitagion.tabs", "navigation.top"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6df46069.min.js"></script>
      
    
  </body>
</html>